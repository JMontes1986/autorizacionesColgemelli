<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<!-- HEADERS DE SEGURIDAD MEJORADOS -->
<meta content="default-src 'self' blob: https://cdn.jsdelivr.net https://cdn.stimulsoft.com https://mbosvnmhnbrslfwlfcxu.supabase.co https://*.sharepoint.com https://*.1drv.ms; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdn.stimulsoft.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https://via.placeholder.com https://mbosvnmhnbrslfwlfcxu.supabase.co https://*.sharepoint.com https://*.1drv.ms; frame-src 'none'; connect-src 'self' blob: https://mbosvnmhnbrslfwlfcxu.supabase.co;" http-equiv="Content-Security-Policy"/>
<meta content="DENY" http-equiv="X-Frame-Options"/>
<meta content="nosniff" http-equiv="X-Content-Type-Options"/>
<meta content="1; mode=block" http-equiv="X-XSS-Protection"/>
<meta content="strict-origin-when-cross-origin" http-equiv="Referrer-Policy"/>
<meta content="geolocation=(), microphone=(), camera=()" http-equiv="Permissions-Policy"/>
<meta content="noindex, nofollow" name="robots"/>
<title>Sistema de Salidas - Colegio Gemelli</title>
<!-- Supabase CDN para GitHub -->
<script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!-- CryptoJS para cifrado de contraseÃ±as -->
<script defer src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
<!-- Animaciones con GSAP -->
    <script defer src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
    <!-- Chart.js desde CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" defer></script>
<!-- Stimulsoft Reports.JS -->
    <script src="https://cdn.stimulsoft.com/js/stimulsoft.reports.js" defer></script>
    <script src="https://cdn.stimulsoft.com/js/stimulsoft.viewer.js" defer></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
<div class="header">
<img alt="Logo Colegio Gemelli" class="logo" src="https://mbosvnmhnbrslfwlfcxu.supabase.co/storage/v1/object/sign/autorizaciones/fotos/Logo%20Slogan%20Nuevo%20FINAL-04.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV8zZDJkZjRmNC01MjI1LTQxNGItYmYyNS0zMzZlYTg2YzAzNGEiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJhdXRvcml6YWNpb25lcy9mb3Rvcy9Mb2dvIFNsb2dhbiBOdWV2byBGSU5BTC0wNC5wbmciLCJpYXQiOjE3NTAyOTE0NjksImV4cCI6MTc4MTgyNzQ2OX0.j8YNCebnNTncMgM_sZLQ2GSuWvDtiTIFbM5VSrm1Xcg" width="35" height="35"/>
<h1> Colegio Gemelli Control de Salidas</h1>
<div class="subtitle">@j.montes86</div>
<div class="connection-status" id="connectionStatus">
<span id="connectionIcon">ğŸ”´</span>
<span id="connectionText">Verificando conexiÃ³n...</span>
</div>
<button id="logoutBtn" class="logout-btn" type="button">Cerrar SesiÃ³n</button>
</div>
<div class="content">
<!-- Rate Limit Warning -->
<div class="rate-limit-warning" id="rateLimitWarning">
âš ï¸ Demasiados intentos. Por favor espera antes de intentar de nuevo.
</div>
<!-- Security Indicator -->
<div class="security-indicator secure" id="securityIndicator">
ğŸ”’ ConexiÃ³n Segura
</div>
<!-- Login Form -->
<div class="login-form" id="loginSection">
<div class="form-group">
<label for="email">Email:</label>
<input autocomplete="username" id="email" maxlength="100" oninput="validateEmailInput(this)" pattern="^[a-zA-Z0-9._%+-]+@colgemelli.edu.co$" placeholder="sistemas@colgemelli.edu.co" required="True" title="Debe ser un correo institucional vÃ¡lido" type="email"/>
</div>
<div class="form-group">
<label for="password">ContraseÃ±a:</label>
<div class="input-with-icon">
<input autocomplete="current-password" id="password" maxlength="50" oninput="validatePasswordInput(this)" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" type="password"/>
<span class="toggle-password" onclick="togglePasswordVisibility('password', this)">ğŸ‘ï¸</span>
</div>
<div class="password-strength" id="passwordStrength" style="display: none;"></div>
</div>
<!-- DesafÃ­o AritmÃ©tico -->
<div class="captcha-container">
<label id="captchaQuestion">Pregunta</label>
<input id="captchaAnswer" type="number" inputmode="numeric" placeholder="Respuesta" />
</div>
<button class="btn" id="loginBtn" onclick="login()" style="width: 100%;">Iniciar SesiÃ³n</button>
<button class="btn btn-secondary" id="testConnectionBtn" style="width: 100%; margin-top: 10px;">ğŸ”„ Probar ConexiÃ³n</button>
<div class="login-messages" id="loginMessages" style="margin-top: 15px;">
    <div class="alert alert-error" id="loginError" style="visibility: hidden;"></div>
    <div class="alert alert-success" id="loginInfo" style="visibility: hidden;"></div>
</div>
</div>
<!-- Dashboard -->
<div class="dashboard" id="dashboard">
<div class="nav-buttons" id="navButtons">
<!-- Botones se cargarÃ¡n dinÃ¡micamente segÃºn el rol -->
<button class="btn btn-primary" id="btnControlSalidas">ğŸ“‹ Control de Salidas</button></div>
<!-- SecciÃ³n para Autorizar Salidas -->
<div class="section" id="authorizeSectionDiv">
<h2>âœ… Autorizar Salida de Estudiante</h2>
<form id="authorizeForm">
<div class="grid">
<div class="form-group">
<label for="gradeSelect">1. Seleccionar Grado: *</label>
<select id="gradeSelect" onchange="loadStudentsByGrade()" required="">
<option value="">Seleccionar grado primero...</option>
</select>
</div>
<div class="form-group">
<label for="studentSelect">2. Seleccionar Estudiante: *</label>
<select disabled="" id="studentSelect" required="">
<div id="authStudentImage" style="text-align:center; margin:10px 0;">
</div>
<option value="">Primero selecciona un grado...</option>
</select>
</div>
<div class="form-group">
<label for="reasonSelect">3. Motivo: *</label>
<select id="reasonSelect" required="">
<option value="">Seleccionar motivo...</option>
</select>
</div>
<div class="form-group">
<label for="exitDate">4. Fecha de Salida: *</label>
<input id="exitDate" required="" type="date"/>
</div>
<div class="form-group">
<label for="exitTime">5. Hora de Salida: *</label>
<input id="exitTime" required="" type="time"/>
</div>
</div>
<div class="form-group">
<label for="observations">Observaciones adicionales:</label>
<textarea id="observations" maxlength="500" oninput="validateTextInput(this)" placeholder="Observaciones opcionales sobre la salida..." rows="3"></textarea>
</div>
<button class="btn btn-success" style="font-size: 18px; padding: 15px 30px;" type="submit">âœ… Autorizar Salida</button>
</form>
</div>
<!-- SecciÃ³n para Verificar Salidas (Vigilante) -->
<div class="section" id="verifySectionDiv">
<h2>ğŸ” Control de Salidas - Vigilancia</h2>
<div class="nav-buttons">
<button class="btn btn-success" onclick="loadPendingExits()">ğŸ”„ Actualizar Lista</button>
<button class="btn btn-secondary" onclick="toggleSearch()">ğŸ” Buscar Estudiante</button>
<button class="btn btn-warning" onclick="showMyConfirmedExits()">ğŸ‘ï¸ Ver Mis Confirmaciones</button>
</div>
<!-- BÃºsqueda manual (inicialmente oculta) -->
<div id="searchSection" style="display: none; margin-top: 20px;">
<h3 style="color: #2c3e50; margin-bottom: 15px;">ğŸ” BÃºsqueda Manual de Estudiante</h3>
<input class="search-box" id="studentSearch" maxlength="100" oninput="validateSearchInput(this)" placeholder="Buscar estudiante especÃ­fico por nombre..." type="text"/>
<div id="searchResult"></div>
</div>
<!-- SecciÃ³n de salidas confirmadas por el vigilante (inicialmente oculta) -->
<div id="myConfirmedSection" style="display: none; margin-top: 20px;">
<h3 style="color: #2c3e50; margin: 20px 0 15px 0;">âœ… Salidas Confirmadas por MÃ­ Hoy</h3>
<div id="myConfirmedList">
<div class="card" style="text-align: center; padding: 30px;">
<p style="color: #666;">Cargando salidas confirmadas...</p>
</div>
</div>
</div>
<!-- Lista de estudiantes con salidas pendientes -->
<div id="pendingExitsSection">
<h3 style="color: #2c3e50; margin: 20px 0 15px 0;">ğŸ“‹ Estudiantes con Salidas Pendientes para Hoy</h3>
<div id="pendingExitsList">
<!-- Ejemplo de tarjeta con foto -->
<div class="verification-card">
<img alt="Foto estudiante" src="https://via.placeholder.com/120" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; margin-bottom: 10px;"/>
<h3>Nombre Estudiante</h3>
<div class="verification-card-content">
<div class="verification-card-info">
<p><strong>Grado:</strong> 10</p>
<p><strong>Motivo:</strong> Cita mÃ©dica</p>
<p><strong>Hora:</strong> 10:30 am</p>
</div>
</div>
<button class="btn btn-success">âœ… Confirmar Salida</button>
</div>
<div class="card" style="text-align: center; padding: 30px;">
<p style="color: #666;">Cargando estudiantes con salidas pendientes...</p>
</div>
</div>
</div>
</div>
<!-- SecciÃ³n de Llegadas Tarde -->
<div class="section" id="lateArrivalSectionDiv">
<h2 style="margin-bottom: 10px;">â° Registro de Llegadas Tarde</h2>
<div class="login-messages" id="lateArrivalMessages" style="margin-top: 5px;">
    <div class="alert alert-error" id="lateArrivalError" style="visibility: hidden;"></div>
    <div class="alert alert-success" id="lateArrivalInfo" style="visibility: hidden;"></div>
</div>
<form id="lateArrivalForm">
<div class="grid">
<div class="form-group">
<label for="lateGradeSelect">Grado:</label>
<select id="lateGradeSelect">
<option value="">Seleccionar grado...</option>
</select>
</div>
<div class="form-group">
<label for="lateStudentSelect">Estudiante:</label>
<select id="lateStudentSelect" disabled>
<option value="">Primero selecciona un grado...</option>
</select>
</div>
<div class="form-group">
<label for="lateTime">Hora de llegada:</label>
<input type="time" id="lateTime" required />
</div>
<div class="form-group">
<label for="lateExcuse">Excusa vÃ¡lida:</label>
<select id="lateExcuse">
<option value="false">No</option>
<option value="true">SÃ­</option>
</select>
</div>
</div>
<button class="btn btn-danger" type="submit">Registrar Llegada</button>
</form>
</div>
<!-- SecciÃ³n de AdministraciÃ³n -->
<div class="section" id="adminSectionDiv">
<h2>âš™ï¸ Panel de AdministraciÃ³n</h2>
<div class="nav-buttons">
<button class="btn" onclick="showAdminSection('students')">Gestionar Estudiantes</button>
<button class="btn" onclick="showAdminSection('users')">Gestionar Usuarios</button>
<button class="btn" onclick="showAdminSection('reasons')">Gestionar Motivos</button>
<button class="btn" onclick="showAdminSection('grades')">Gestionar Grados</button>
<button class="btn btn-warning" onclick="showAdminSection('security')">ğŸ”’ Seguridad y Logs</button>
</div>
<div class="admin-subsection" id="adminStudents" style="display: none;">
<h3>ğŸ‘¨â€ğŸ“ GestiÃ³n de Estudiantes</h3>
<button class="btn btn-success" onclick="openModal('studentModal')">Agregar Estudiante</button>
<div class="table-wrapper">
<table class="table" id="studentsTable">
<thead>
<tr>
<th style="min-width: 120px;">Nombre</th>
<th style="min-width: 120px;">Apellidos</th>
<th style="min-width: 100px;">Documento</th>
<th style="min-width: 120px;">Grado</th>
<th style="min-width: 160px;">Acciones</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>
<div class="admin-subsection" id="adminUsers" style="display: none;">
<h3>ğŸ‘¥ GestiÃ³n de Usuarios</h3>
<button class="btn btn-success" onclick="openModal('userModal')">Agregar Usuario</button>
<div class="table-wrapper">
<table class="table" id="usersTable">
<thead>
<tr>
<th style="min-width: 120px;">Nombre</th>
<th style="min-width: 200px;">Email</th>
<th style="min-width: 120px;">Rol</th>
<th style="min-width: 80px;">Estado</th>
<th style="min-width: 160px;">Acciones</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>
<div class="admin-subsection" id="adminReasons" style="display: none;">
<h3>ğŸ“ GestiÃ³n de Motivos</h3>
<button class="btn btn-success" onclick="openModal('reasonModal')">Agregar Motivo</button>
<div class="table-wrapper">
<table class="table" id="reasonsTable">
<thead>
<tr>
<th style="min-width: 120px;">Nombre</th>
<th style="min-width: 200px;">DescripciÃ³n</th>
<th style="min-width: 80px;">Estado</th>
<th style="min-width: 160px;">Acciones</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>
<div class="admin-subsection" id="adminGrades" style="display: none;">
<h3>ğŸ“ GestiÃ³n de Grados</h3>
<button class="btn btn-success" onclick="openModal('gradeModal')">Agregar Grado</button>
<div class="table-wrapper">
<table class="table" id="gradesTable">
<thead>
<tr>
<th style="min-width: 120px;">Nombre</th>
<th style="min-width: 100px;">Nivel</th>
<th style="min-width: 80px;">Estado</th>
<th style="min-width: 160px;">Acciones</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>
<!-- SecciÃ³n de Seguridad -->
<div class="admin-subsection" id="adminSecurity" style="display: none;">
<h3>ğŸ”’ Seguridad y Logs de AuditorÃ­a</h3>
<div class="security-stats">
<div class="stat-card">
<h4>Accesos Hoy</h4>
<div class="number" id="todayLogins">0</div>
</div>
<div class="stat-card">
<h4>Cambios Hoy</h4>
<div class="number" id="todayChanges">0</div>
</div>
<div class="stat-card">
<h4>Intentos Fallidos</h4>
<div class="number" id="failedAttempts">0</div>
</div>
<div class="stat-card">
<h4>Usuarios Activos</h4>
<div class="number" id="activeUsers">0</div>
</div>
</div>
<div class="filters-section">
<h4>Filtros de Logs</h4>
<div class="grid">
<div class="form-group">
<label for="logDateFrom">Fecha Desde:</label>
<input id="logDateFrom" type="date"/>
</div>
<div class="form-group">
<label for="logDateTo">Fecha Hasta:</label>
<input id="logDateTo" type="date"/>
</div>
<div class="form-group">
<label for="logType">Tipo de AcciÃ³n:</label>
<select id="logType">
<option value="">Todos</option>
<option value="login">Inicio de SesiÃ³n</option>
<option value="logout">Cierre de SesiÃ³n</option>
<option value="create">CreaciÃ³n</option>
<option value="update">ActualizaciÃ³n</option>
<option value="delete">EliminaciÃ³n</option>
<option value="error">Error</option>
</select>
</div>
<div class="form-group">
<label for="logUser">Usuario:</label>
<select id="logUser">
<option value="">Todos</option>
</select>
</div>
</div>
<button class="btn" onclick="loadSecurityLogs()">ğŸ” Buscar Logs</button>
<button id="exportLogsBtn" class="btn btn-secondary" onclick="exportLogs()">ğŸ“¥ Exportar Logs</button>
<div id="logExportMessage" class="alert" style="visibility: hidden;"></div>
</div>
<div class="table-wrapper">
<table class="table" id="securityLogsTable">
<thead>
<tr>
<th style="min-width: 140px;">Fecha/Hora</th>
<th style="min-width: 120px;">Usuario</th>
<th style="min-width: 80px;">Tipo</th>
<th style="min-width: 140px;">AcciÃ³n</th>
<th style="min-width: 200px;">Detalles</th>
<th style="min-width: 100px;">IP</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>
</div>
<!-- SecciÃ³n de Dashboard (NUEVA) -->
<div class="section" id="dashboardSectionDiv">
<h2>ğŸ“Š Dashboard de Salidas</h2>
<div class="dashboard-container">
<!-- Filtros de Fecha para Dashboard HistÃ³rico -->
<!-- Nuevos GrÃ¡ficos HistÃ³ricos -->
<!-- EstadÃ­sticas Generales -->
<div class="dashboard-card">
<h3>ğŸ“ˆ EstadÃ­sticas de Hoy</h3>
<div class="stats-grid">
<div class="stat-item pending-exits">
<div class="stat-number" id="dashPendingCount">0</div>
<div class="stat-label">Pendientes</div>
</div>
<div class="stat-item confirmed-exits">
<div class="stat-number" id="dashConfirmedCount">0</div>
<div class="stat-label">Confirmadas</div>
</div>
<div class="stat-item total-today">
<div class="stat-number" id="dashTotalCount">0</div>
<div class="stat-label">Total Hoy</div>
</div>
<div class="stat-item recent-activity">
<div class="stat-number" id="dashRecentCount">0</div>
<div class="stat-label">Ãšltima Hora</div>
</div>
</div>
</div>
<!-- GrÃ¡fico de Estado de Salidas -->
<div class="dashboard-card">
<h3>ğŸŸ¢ğŸ”µ Estado de Salidas</h3>
<div class="chart-container">
<canvas id="statusChart"></canvas>
<div id="statusChartFallback" style="display: none; text-align: center; padding: 20px; color: #666;">
<p>ğŸ“Š Cargando grÃ¡fico...</p>
<p><small>Si no aparece, revisa que Chart.js estÃ© cargado</small></p>
</div>
</div>
</div>
<!-- GrÃ¡fico por Grados -->
<div class="dashboard-card">
<h3>ğŸ“ Salidas por Grado</h3>
<div class="chart-container">
<canvas id="gradeChart"></canvas>
<div id="gradeChartFallback" style="display: none; text-align: center; padding: 20px; color: #666;">
<p>ğŸ“Š Cargando grÃ¡fico...</p>
</div>
</div>
</div>
<!-- Actividad Reciente -->
<div class="dashboard-card">
<h3>â° Actividad Reciente</h3>
<div class="recent-students" id="recentActivity">
<p style="text-align: center; color: #666; padding: 20px;">Cargando actividad reciente...</p>
</div>
</div>
<!-- GrÃ¡fico de Motivos -->
<div class="dashboard-card">
<h3>ğŸ“ Motivos de Salida</h3>
<div class="chart-container">
<canvas id="reasonChart"></canvas>
<div id="reasonChartFallback" style="display: none; text-align: center; padding: 20px; color: #666;">
<p>ğŸ“Š Cargando grÃ¡fico...</p>
</div>
</div>
</div>
<!-- Timeline de Salidas -->
<div class="dashboard-card">
<h3>â±ï¸ Timeline de Salidas Hoy</h3>
<div class="chart-container">
<canvas id="timelineChart"></canvas>
<div id="timelineChartFallback" style="display: none; text-align: center; padding: 20px; color: #666;">
<p>ğŸ“Š Cargando grÃ¡fico...</p>
</div>
</div>
</div>
</div>
<!-- Filtros de Fecha para Dashboard HistÃ³rico -->
<!-- Nuevos GrÃ¡ficos HistÃ³ricos -->
<!-- Controles del Dashboard -->
<div class="nav-buttons" id="dashboardButtons" style="margin-top: 20px;">
<button class="btn btn-success" onclick="refreshDashboard()">ğŸ”„ Actualizar Dashboard</button>
<button id="exportDashboardBtn" class="btn btn-secondary">ğŸ“¥ Exportar Datos</button>
    <button id="generalReportBtn" class="btn btn-warning" onclick="abrirReporte()" style="display:none;">ğŸ“„ Reporte</button>
    <button class="btn btn-secondary" id="showReportBtn" onclick="showReport()" style="display:none;">ğŸ“„ Reporte Diario</button>
    <button class="btn" onclick="showDetailedView()">ğŸ“‹ DiagnÃ³stico</button>
<button class="btn btn-warning" onclick="debugDashboard()" style="font-size: 12px;">ğŸ”§ Debug</button>
<button class="btn btn-warning" id="lateReportBtn" onclick="mostrarReporteLlegadas()" style="display:none;">ğŸ“„ Reporte Llegadas</button>
</div>
<div id="chartjsStatus" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; text-align: center; display: none;">
<p style="margin: 0; color: #666;"><strong>Estado Chart.js:</strong> <span id="chartjsStatusText">Verificando...</span></p>
</div>
</div>
<!-- SecciÃ³n de Historial -->
<div class="section" id="historySectionDiv">
<h2>ğŸ“‹ Historial de Autorizaciones</h2>
<div class="form-group">
<input id="historyDate" onchange="loadHistory()" type="date"/>
<button class="btn" onclick="loadHistory()">Filtrar por Fecha</button>
<button class="btn btn-secondary" onclick="loadHistory(true)">Ver Todo el Historial</button>
<button class="btn" onclick="debugHistory()" style="background: #e67e22;">ğŸ” Debug Historial</button>
</div>
<div id="historyDebug" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 10px 0;">
<h4>ğŸ”§ InformaciÃ³n de Debug:</h4>
<div id="historyDebugContent"></div>
</div>
<div class="table-wrapper">
<table class="table" id="historyTable">
<thead>
<tr>
<th style="min-width: 150px;">Estudiante</th>
<th style="min-width: 120px;">Grado</th>
<th style="min-width: 140px;">Motivo</th>
<th style="min-width: 110px;">Fecha Salida</th>
<th style="min-width: 100px;">Hora Salida</th>
<th style="min-width: 140px;">Autorizado por</th>
<th style="min-width: 160px;">Estado</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<div class="scroll-hint" style="text-align: center; font-size: 12px; color: #666; padding: 8px; background: #f8f9fa; border-top: 1px solid #ddd; border-radius: 0 0 8px 8px;">
ğŸ’¡ Desliza horizontalmente para ver toda la informaciÃ³n
</div>
</div>
</div>
</div>
</div>
<div id="seccion-reporte-mensual" style="display:none;">
  <h2>ğŸ“Š Reporte mensual de autorizaciones</h2>
  <input type="month" id="mesReporte" onchange="mostrarReporteMensual()">
  <div id="contenedor-reporte"></div>
</div>
<!-- Modals -->
<div class="modal" id="studentModal">
<div class="modal-content">
<span class="close" onclick="closeModal('studentModal')">Ã—</span>
<h2>Agregar/Editar Estudiante</h2>
<form id="studentForm">
<div class="form-group">
<label for="uploadStudentPhoto">Subir Foto:</label>
<input accept="image/jpeg,image/png,image/gif" id="uploadStudentPhoto" onchange="handleImageUpload(event)" type="file"/>
<img alt="Foto del estudiante" id="studentPhotoPreview" src="https://via.placeholder.com/120" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; display: block; margin: 10px auto; border: 2px solid #ccc;"/>
<small>Formatos permitidos: JPG, PNG, GIF. MÃ¡ximo 2MB.</small>
</div>
<div class="form-group">
<label>Nombre: *</label>
<input id="studentName" maxlength="50" oninput="validateNameInput(this)" pattern="[A-Za-zÃ€-Ã¿\s]{2,50}" required="" type="text"/>
</div>
<div class="form-group">
<label>Apellidos: *</label>
<input id="studentLastName" maxlength="50" oninput="validateNameInput(this)" pattern="[A-Za-zÃ€-Ã¿\s]{2,50}" required="" type="text"/>
</div>
<div class="form-group">
<label>Documento:</label>
<input id="studentDocument" maxlength="20" oninput="validateDocumentInput(this)" pattern="[0-9]{6,20}" type="text"/>
</div>
<div class="form-group">
<label>Grado: *</label>
<select id="studentGrade" required="">
<option value="">Seleccionar grado...</option>
</select>
</div>
<button class="btn btn-success" type="submit">Guardar</button>
<button id="cancelStudentModal" class="btn btn-secondary" onclick="closeModal('studentModal')" type="button">Cancelar</button>
</form>
</div>
</div>
<div class="modal" id="userModal">
<div class="modal-content">
<span class="close" onclick="closeModal('userModal')">Ã—</span>
<h2>Agregar/Editar Usuario</h2>
<form id="userForm">
<div class="form-group">
<label>Nombre: *</label>
<input id="userName" maxlength="50" oninput="validateNameInput(this)" pattern="[A-Za-zÃ€-Ã¿\s]{2,50}" required="" type="text"/>
</div>
<div class="form-group">
<label>Email: *</label>
<input id="userEmail" maxlength="100" oninput="validateEmailInput(this)" required="" type="email"/>
</div>
<div class="form-group">
<label>ContraseÃ±a: <span id="passwordNote">(dejar vacÃ­o para mantener actual)</span></label>
<div class="input-with-icon">
<input id="userPassword" maxlength="50" oninput="validatePasswordInput(this)" onkeyup="checkPasswordStrength()" type="password"/>
<span class="toggle-password" onclick="togglePasswordVisibility('userPassword', this)">ğŸ‘ï¸</span>
</div>
<div class="password-strength" id="userPasswordStrength" style="display: none;"></div>
</div>
<div class="form-group">
<label>Rol: *</label>
<select id="userRole" required="">
<option value="">Seleccionar rol...</option>
</select>
</div>
<button class="btn btn-success" type="submit">Guardar</button>
<button id="cancelUserModal" class="btn btn-secondary" onclick="closeModal('userModal')" type="button">Cancelar</button>
</form>
</div>
</div>
<div class="modal" id="reasonModal">
<div class="modal-content">
<span class="close" onclick="closeModal('reasonModal')">Ã—</span>
<h2>Agregar/Editar Motivo</h2>
<form id="reasonForm">
<div class="form-group">
<label>Nombre: *</label>
<input id="reasonName" maxlength="50" oninput="validateTextInput(this)" required="" type="text"/>
</div>
<div class="form-group">
<label>DescripciÃ³n:</label>
<textarea id="reasonDescription" maxlength="200" oninput="validateTextInput(this)" rows="3"></textarea>
</div>
<button class="btn btn-success" type="submit">Guardar</button>
<button id="cancelReasonModal" class="btn btn-secondary" onclick="closeModal('reasonModal')" type="button">Cancelar</button>
</form>
</div>
</div>
<div class="modal" id="gradeModal">
<div class="modal-content">
<span class="close" onclick="closeModal('gradeModal')">Ã—</span>
<h2>Agregar/Editar Grado</h2>
<form id="gradeForm">
<div class="form-group">
<label>Nombre: *</label>
<input id="gradeName" maxlength="20" oninput="validateTextInput(this)" required="" type="text"/>
</div>
<div class="form-group">
<label>Nivel: *</label>
<select id="gradeLevel" required="">
<option value="">Seleccionar nivel...</option>
<option value="Primaria">Primaria</option>
<option value="Bachillerato">Bachillerato</option>
</select>
</div>
<button class="btn btn-success" type="submit">Guardar</button>
<button id="cancelGradeModal" class="btn btn-secondary" onclick="closeModal('gradeModal')" type="button">Cancelar</button>
</form>
</div>
</div>
<!-- Modal para advertir salidas pendientes -->
<div class="modal" id="pendingExitModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('pendingExitModal')">Ã—</span>
    <h2>âš ï¸ Salida Pendiente Detectada</h2>
    <div id="pendingExitDetails" style="margin-bottom:20px;"></div>
    <button class="btn btn-secondary" onclick="closeModal('pendingExitModal')" type="button">Cerrar</button>
  </div>
</div>
<div class="modal" id="reportModal">
<div class="modal-content" style="max-width:90%;width:95%;height:90vh;">
<span class="close" onclick="closeModal('reportModal')">Ã—</span>
<div id="reportViewer" style="width:100%;height:100%;"></div>
</div>
</div>
<script defer src="env.js"></script>
<script defer src="app.js"></script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').catch(err => {
      console.error('Error registrando Service Worker:', err);
    });
  }
</script>
<footer>VersiÃ³n v1.0.0 â€“ CompilaciÃ³n 2</footer>
</body>
</html>
